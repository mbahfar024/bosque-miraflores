<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bosque Mediterráneo - IES Miraflores</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

    <style>
        :root {
            --verde-ies: #2d5a27;
            --verde-claro: #4a8a3f;
            --crema: #f4f1ea;
            --blanco: #ffffff;
        }

        /* RESET Y ESTRUCTURA */
        * { box-sizing: border-box; }
        body, html { 
            margin: 0; padding: 0; 
            height: 100vh; width: 100vw; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: var(--verde-ies); 
        }

        .app-container {
            display: grid;
            grid-template-columns: 320px 1fr;
            height: 100vh;
            gap: 0; 
        }

        /* BARRA LATERAL */
        aside {
            background: var(--verde-ies);
            color: white;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 1001;
            box-shadow: 4px 0 15px rgba(0,0,0,0.3);
            position: relative;
        }

        .logo-centro {
            width: 100px; 
            background: transparent; 
            align-self: center;
            display: block;
        }

        .titulos h1 { font-size: 1.5rem; margin: 0; line-height: 1.2; }
        .titulos p { font-size: 0.9rem; opacity: 0.8; margin-top: 5px; }

        .buscador-container { margin-top: 10px; }
        select { 
            width: 100%; padding: 12px; border-radius: 8px; border: none; 
            font-size: 1rem; cursor: pointer; outline: none;
        }

        /* MAPA */
        main { position: relative; height: 100%; width: 100%; z-index: 1; }
        #map { height: 100%; width: 100%; background: #ddd; }

        /* --- ESTILOS DE LOS PUNTOS (MARCADORES) --- */
        .leaflet-div-icon { background: transparent; border: none; }

        /* Estilo Base (Zoom 19) */
        .punto-mapa {
            width: 24px; height: 24px;
            background: white; color: var(--verde-ies);
            border: 2px solid var(--verde-ies);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 11px; font-weight: bold;
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(0,0,0,0.4);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Efecto rebote suave */
        }

        /* ESTADO ACTIVO O HOVER (Siempre grande) */
        .punto-mapa:hover, .punto-mapa.activo {
            transform: scale(1.3) !important; /* El important asegura que gane al zoom */
            background: var(--verde-ies); color: white;
            border-color: white;
            z-index: 1000 !important;
        }

        /* --- REGLAS DE TAMAÑO SEGÚN ZOOM --- */
        
        /* Zoom Lejano (17 o menos): Puntos pequeños, sin número */
        .z-17 .punto-mapa, .z-16 .punto-mapa, .z-15 .punto-mapa {
            width: 12px; height: 12px; 
            font-size: 0; /* Oculta el número */
            border-width: 1px;
        }

        /* Zoom Medio (18): Un poco más pequeños */
        .z-18 .punto-mapa {
            width: 18px; height: 18px;
            font-size: 9px;
        }

        /* Zoom Normal (19): Tamaño base (definido arriba) */

        /* Zoom Cercano (20): Más grandes */
        .z-20 .punto-mapa {
            width: 32px; height: 32px;
            font-size: 14px;
        }

        /* Zoom Máximo (21): Gigantes */
        .z-21 .punto-mapa {
            width: 42px; height: 42px;
            font-size: 16px;
            border-width: 3px;
        }

        /* TOOLTIP (Etiqueta nombre) */
        .leaflet-tooltip {
            background: white; border: 1px solid var(--verde-ies);
            color: var(--verde-ies); font-weight: bold;
            border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* MODAL */
        .modal { 
            display: none; position: fixed; z-index: 2000; 
            left: 0; top: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.7); backdrop-filter: blur(3px); 
        }
        .modal-content { 
            background: white; margin: 10vh auto; padding: 30px; 
            width: 90%; max-width: 450px; border-radius: 20px; 
            position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            color: #333;
            animation: aparicion 0.3s ease-out;
        }

        @keyframes aparicion { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container { grid-template-columns: 1fr; grid-template-rows: auto 1fr; }
            aside { padding: 15px; flex-direction: row; align-items: center; height: auto; gap: 15px; }
            .titulos h1 { font-size: 1rem; }
            .titulos p, .logo-centro { display: none; }
            .buscador-container { flex-grow: 1; margin: 0; }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <aside>
            <img src="logo-ies.png" alt="Logo" class="logo-centro">
            <div class="titulos">
                <h1>Bosque Mediterráneo</h1>
                <p>IES Miraflores de los Ángeles</p>
            </div>
            <div class="buscador-container">
                <select id="selector-plantas">
                    <option value="">Buscar especie...</option>
                </select>
            </div>
            <div style="margin-top: auto; font-size: 0.7rem; opacity: 0.5; text-align: center;">
                © 2026 IES Miraflores
            </div>
        </aside>

        <main>
            <div id="map"></div>
        </main>
    </div>

    <div id="modal-ficha" class="modal">
        <div class="modal-content">
            <span style="position:absolute; right:20px; top:15px; font-size:30px; cursor:pointer; color:#999;" onclick="cerrarFicha()">&times;</span>
            <div id="detalle-planta"></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <script>
        const plantasInfo = {
            "001": { n: "Acanto", c: "Acanthus mollis", d: "Sus hojas inspiraron los capiteles corintios.", a: "Alberto Alarcón", lat: 36.732853, lng: -4.437585 },
            "002": { n: "Acebuche", c: "Olea europaea", d: "Padre de todos los olivos.", a: "Carla Guerrero", lat: 36.732765, lng: -4.437664 },
            "003": { n: "Adelfa", c: "Nerium oleander", d: "Muy bella pero tóxica.", a: "Ainara Ruiz", lat: 36.732769, lng: -4.437721 },
            "004": { n: "Agracejo", c: "Berberis vulgaris", d: "Tiene propiedades medicinales.", a: "María Casal", lat: 36.732700, lng: -4.437601 },
            "005": { n: "Aladierno", c: "Rhamnus alaternus", d: "Atrae a los pájaros con sus frutos.", a: "Lucía Moreno", lat: 36.733121, lng: -4.438086 },
            "006": { n: "Álamo Blanco", c: "Populus alba", d: "Madera usada para la Mona Lisa.", a: "Nuria Pendón", lat: 36.732961, lng: -4.438003 },
            "007": { n: "Alcornoque", c: "Quercus suber", d: "Se utiliza para hacer carbón.", a: "Rubén García", lat: 36.732838, lng: -4.437849 },
            "008": { n: "Algarrobo", c: "Ceratonia siliqua", d: "Chocolate mediterráneo.", a: "Christian Cobos", lat: 36.732734, lng: -4.437646 },
            "009": { n: "Aligustre", c: "Ligustrum vulgare", d: "Arbusto de 2 metros de altura.", a: "Rubén García", lat: 36.736545, lng: -4.453526 },
            "010": { n: "Almez", c: "Celtis australis", d: "Ramas usadas para hacer látigos.", a: "Paula Vivian", lat: 36.732764, lng: -4.437601 },
            "011": { n: "Boj", c: "Buxus sempervirens", d: "Se utiliza para hacer setos.", a: "Paula Vivian", lat: 36.733048, lng: -4.437904 },
            "012": { n: "Cornicabra", c: "Pistacia terebinthus", d: "Se utiliza para alimentar al ganado.", a: "Paula Vivian", lat: 36.732730, lng: -4.437805 },
            "013": { n: "Durillo", c: "Viburnum tinus", d: "Se utiliza para hacer setos.", a: "Nuria Pendón", lat: 36.733028, lng: -4.438065 },
            "014": { n: "Encina", c: "Quercus ilex", d: "Símbolo de la dehesa española.", a: "Lucía Moreno", lat: 36.736533, lng: -4.453284 },
            "015": { n: "Fresno", c: "Fraxinus ornus", d: "Madera elástica de alta calidad.", a: "Nuria Pendón", lat: 36.732696, lng: -4.437761 },
            "016": { n: "Granado", c: "Punica granatum", d: "Fruto lleno de rubíes.", a: "Christian Cobos", lat: 36.732805, lng: -4.437725 },
            "017": { n: "Higuera", c: "Ficus carica", d: "Higos: flores encerradas.", a: "Víctor Sánchez", lat: 36.732769, lng: -4.437622 },
            "018": { n: "Labiérnago", c: "Phillyrea angustifolia", d: "Hojas lanceoladas estrechas.", a: "Alejandro Muñoz", lat: 36.733114, lng: -4.438204 },
            "019": { n: "Labiérnago Negro", c: "Phillyrea latifolia", d: "Resiste sequías extremas.", a: "Alejandro Muñoz", lat: 36.733121, lng: -4.438058 },
            "020": { n: "Laurel", c: "Laurus nobilis", d: "Condimento y premio de gloria.", a: "David Martín", lat: 36.733057, lng: -4.437848 },
            "021": { n: "Lentisco", c: "Pistacia lentiscus", d: "Antiguamente se usaba para hacer chicle.", a: "David Martín", lat: 36.733060, lng: -4.437993 },
            "022": { n: "Madreselva", c: "Lonicera periclymenum", d: "Arbusto utilizado en vallas.", a: "María Casal", lat: 36.732991, lng: -4.437978 },
            "023": { n: "Madroño", c: "Arbutus unedo", d: "Frutos comestibles fermentados.", a: "Ainara Ruiz", lat: 36.732996, lng: -4.437943 },
            "024": { n: "Majuelo", c: "Crataegus monogyna", d: "Flor del corazón.", a: "Ainara Ruiz", lat: 36.732768, lng: -4.437819 },
            "025": { n: "Marrubio", c: "Marrubium vulgare", d: "Té amargo contra la tos.", a: "Lucía Moreno", lat: 36.736793, lng: -4.453347 },
            "026": { n: "Matagallo", c: "Phlomis purpurea", d: "Se utilizaban para hacer mechas.", a: "Ainara Ruiz", lat: 36.733031, lng: -4.438024 },
            "027": { n: "Mirto", c: "Myrtus communis", d: "Símbolo de amor y pureza.", a: "Paula Vivian", lat: 36.736737, lng: -4.453275 },
            "028": { n: "Morera Blanca", c: "Morus alba", d: "Llegó de Oriente por la seda.", a: "María Casal", lat: 36.733080, lng: -4.438106 },
            "029": { n: "Olivilla", c: "Teucrium fruticans", d: "Arbusto de color gris plateado.", a: "Alejandro Muñoz", lat: 36.733070, lng: -4.437866 },
            "030": { n: "Olivo", c: "Olea europaea", d: "Árbol sagrado del Mediterráneo.", a: "Alberto Alarcón", lat: 36.732835, lng: -4.437910 },
            "031": { n: "Palmera canaria", c: "Phoenix canariensis", d: "Producen frutos comestibles.", a: "Víctor Sánchez", lat: 36.732949, lng: -4.437968 },
            "032": { n: "Palmito", c: "Chamaerops humilis", d: "Sus hojas se utilizan para hacer cestas.", a: "Alba Fuentes", lat: 36.732716, lng: -4.437583 },
            "033": { n: "Pino Carrasco", c: "Pinus halepensis", d: "El pino más común en Málaga.", a: "Attahirou Bachir", lat: 36.733202, lng: -4.438044 },
            "034": { n: "Pino Piñonero", c: "Pinus pinea", d: "Copa en forma de sombrilla.", a: "Víctor Sánchez", lat: 36.736898, lng: -4.453470 },
            "035": { n: "Quejigo", c: "Quercus faginea", d: "Un roble mediterráneo.", a: "Ainhoa Navarro", lat: 36.732790, lng: -4.437858 },
            "036": { n: "Romero", c: "Salvia rosmarinus", d: "Planta de uso aromático y medicinal.", a: "Carla Guerrero", lat: 36.732915, lng: -4.437852 },
            "037": { n: "Rusco", c: "Ruscus aculeatus", d: "Bolas rojas en tallos punzantes.", a: "Alejandro Muñoz", lat: 36.732917, lng: -4.437899 },
            "038": { n: "Sabina albar", c: "Juniperus thurifera", d: "Se utiliza para aromas balsámicos.", a: "Carla Guerrero", lat: 36.732856, lng: -4.43784 },
            "039": { n: "Taraje", c: "Tamarix sp", d: "En algunos países se usa como edulcorante.", a: "Carla Guerrero", lat: 36.732759, lng: -4.437849 }
        };

        let map;
        let marcadores = {}; 

        function inicializarApp() {
            // 1. CONFIGURACIÓN DEL MAPA
            map = L.map('map', {
                zoomControl: false // Opcional: muevelo si quieres
            }).setView([36.732868, -4.438216], 19); 
            
            // Añadimos control de zoom arriba a la derecha (opcional, más cómodo)
            L.control.zoom({ position: 'topright' }).addTo(map);

            // CAPA GOOGLE SATELLITE (Gratis/No-oficial)
            L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
                maxZoom: 21,
                maxNativeZoom: 20,
                subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
                attribution: '© Google'
            }).addTo(map);

            // CAPA ETIQUETAS
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}{r}.png', {
                attribution: 'OpenStreetMap',
                pane: 'shadowPane' 
            }).addTo(map);

            // ----------------------------------------------------
            // LÓGICA DE ZOOM DINÁMICO
            // ----------------------------------------------------
            function actualizarClaseZoom() {
                const z = map.getZoom();
                const mapDiv = document.getElementById('map');
                
                // Quitamos cualquier clase z-XX antigua
                mapDiv.className = mapDiv.className.replace(/\bz-\d+\b/g, '').trim();
                
                // Añadimos la nueva clase (ej: z-19)
                mapDiv.classList.add('z-' + z);
            }

            // Escuchamos el evento de zoom y ejecutamos al inicio
            map.on('zoomend', actualizarClaseZoom);
            actualizarClaseZoom();
            // ----------------------------------------------------

            // 2. GENERAR MARCADORES
            const selector = document.getElementById('selector-plantas');
            const listaOrdenada = Object.keys(plantasInfo).map(id => ({
                id: id, ...plantasInfo[id]
            })).sort((a, b) => a.n.localeCompare(b.n));

            listaOrdenada.forEach(planta => {
                const opt = document.createElement('option');
                opt.value = planta.id;
                opt.innerText = planta.n;
                selector.appendChild(opt);

                const customIcon = L.divIcon({
                    className: 'leaflet-div-icon',
                    html: `<div class="punto-mapa" id="marker-${planta.id}">${parseInt(planta.id)}</div>`,
                    iconSize: [24, 24], // Tamaño base (el CSS manda sobre esto visualmente)
                    iconAnchor: [12, 12]
                });

                const marker = L.marker([planta.lat, planta.lng], {icon: customIcon}).addTo(map);

                marker.bindTooltip(planta.n, {
                    direction: 'top',
                    offset: [0, -10],
                    opacity: 0.9
                });

                marker.on('click', () => abrirFicha(planta.id));
                marcadores[planta.id] = marker;
            });

            selector.addEventListener('change', (e) => {
                if(e.target.value) abrirFicha(e.target.value);
            });

            // 3. AYUDA COORDENADAS
            map.on('click', function(e) {
                const lat = e.latlng.lat.toFixed(6);
                const lng = e.latlng.lng.toFixed(6);
                L.popup()
                    .setLatLng(e.latlng)
                    .setContent(`<div style="text-align:center; font-size:13px;"><b>Ubicación:</b><br>${lat}, ${lng}</div>`)
                    .openOn(map);
            });
        }

        function abrirFicha(id) {
            const p = plantasInfo[id];
            const urlFicha = `./fichas/planta${id}.jpg`;
            
            if(marcadores[id]) {
                map.flyTo(marcadores[id].getLatLng(), 20, { duration: 1.5 });
                
                document.querySelectorAll('.punto-mapa').forEach(el => el.classList.remove('activo'));
                const el = document.getElementById(`marker-${id}`);
                if(el) el.classList.add('activo');
            }

            document.getElementById('detalle-planta').innerHTML = `
                <h2 style="color:var(--verde-ies); margin-top:0;">${p.n}</h2>
                <p><i>${p.c}</i></p>
                <div style="background:#f9f9f9; padding:15px; border-radius:10px; border-left:5px solid var(--verde-ies);">
                    <strong>Dato curioso:</strong><br>${p.d}
                </div>
                <p style="font-size:11px; color:#aaa; margin-top:20px;">Ficha por: ${p.a}</p>
                
                <button onclick="verImagenCompleta('${urlFicha}')"
                   style="display:block; width:100%; margin-top:15px; padding:12px; background:var(--verde-ies); color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer; font-family:inherit; font-size:1rem;">
                   Ver Ficha Completa
                </button>
            `;
            
            document.getElementById('modal-ficha').style.display = 'block';
            document.getElementById('selector-plantas').value = id;
        }

        function cerrarFicha() {
            document.getElementById('modal-ficha').style.display = 'none';
            document.getElementById('selector-plantas').value = "";
            document.querySelectorAll('.punto-mapa').forEach(el => el.classList.remove('activo'));
        }

        function verImagenCompleta(url) {
            window.open(url, '_blank');
            document.getElementById('modal-ficha').style.display = 'none';
        }

        window.onload = inicializarApp;
    </script>
</body>
</html>